<div class="admin-product-form">
  <div class="form-header mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">
      {{ isEditMode ? 'Editar Producto' : 'Agregar Nuevo Producto' }}
    </h1>
    <p class="text-gray-600">
      {{ isEditMode ? 'Modifica los detalles del producto existente' : 'Completa la información del nuevo producto' }}
    </p>
  </div>

  <div *ngIf="isLoading" class="loading text-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"></div>
    <p class="text-gray-600 mt-4">Cargando producto...</p>
  </div>

  <form *ngIf="!isLoading" [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form bg-white rounded-lg shadow-md p-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Basic Information -->
      <div class="basic-info lg:col-span-2">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200">
          Información Básica
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-group">
            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
              Nombre del Producto *
            </label>
            <input type="text"
                   id="name"
                   formControlName="name"
                   placeholder="Ej: Bolsa Ecológica Premium"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                   [class.border-red-500]="name?.invalid && name?.touched">
            <div *ngIf="name?.invalid && name?.touched" class="error-message text-red-600 text-sm mt-1">
              {{ getFieldError('name') }}
            </div>
          </div>

          <div class="form-group">
            <label for="category" class="block text-sm font-medium text-gray-700 mb-2">
              Categoría *
            </label>
            <select id="category"
                    formControlName="category"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                    [class.border-red-500]="category?.invalid && category?.touched">
              <option value="">Seleccionar categoría</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
            <div *ngIf="category?.invalid && category?.touched" class="error-message text-red-600 text-sm mt-1">
              {{ getFieldError('category') }}
            </div>
          </div>
        </div>

        <div class="form-group mt-6">
          <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
            Descripción *
          </label>
          <textarea id="description"
                    formControlName="description"
                    rows="4"
                    placeholder="Describe las características ecológicas y beneficios del producto..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors resize-vertical"
                    [class.border-red-500]="description?.invalid && description?.touched"></textarea>
          <div *ngIf="description?.invalid && description?.touched" class="error-message text-red-600 text-sm mt-1">
            {{ getFieldError('description') }}
          </div>
        </div>
      </div>

      <!-- Pricing and Stock -->
      <div class="pricing-stock">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200">
          Precio y Stock
        </h2>

        <div class="form-group mb-6">
          <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
            Precio (USD) *
          </label>
          <input type="number"
                 id="price"
                 formControlName="price"
                 step="0.01"
                 min="0.01"
                 placeholder="0.00"
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                 [class.border-red-500]="price?.invalid && price?.touched">
          <div *ngIf="price?.invalid && price?.touched" class="error-message text-red-600 text-sm mt-1">
            {{ getFieldError('price') }}
          </div>
        </div>

        <div class="form-group">
          <label class="block text-sm font-medium text-gray-700 mb-3">
            Estado del Stock *
          </label>
          <div class="flex items-center space-x-6">
            <label class="flex items-center">
              <input type="radio"
                     formControlName="inStock"
                     [value]="true"
                     class="text-green-600 focus:ring-green-500">
              <span class="ml-2 text-sm text-gray-700">En Stock</span>
            </label>
            <label class="flex items-center">
              <input type="radio"
                     formControlName="inStock"
                     [value]="false"
                     class="text-red-600 focus:ring-red-500">
              <span class="ml-2 text-sm text-gray-700">Agotado</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Image -->
      <div class="image-section">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200">
          Imagen del Producto
        </h2>

        <div class="form-group">
          <label for="imageFile" class="block text-sm font-medium text-gray-700 mb-2">
            Subir Imagen
          </label>
          <input type="file"
                 id="imageFile"
                 accept="image/*"
                 (change)="onImageFileSelected($event)"
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors">
          <p class="text-xs text-gray-500 mt-1">O ingresa una URL directamente abajo</p>
        </div>

        <div class="form-group mt-4">
          <label for="imageUrl" class="block text-sm font-medium text-gray-700 mb-2">
            URL de la Imagen *
          </label>
          <input type="url"
                 id="imageUrl"
                 formControlName="imageUrl"
                 placeholder="https://ejemplo.com/imagen.jpg"
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                 [class.border-red-500]="imageUrl?.invalid && imageUrl?.touched">
          <div *ngIf="imageUrl?.invalid && imageUrl?.touched" class="error-message text-red-600 text-sm mt-1">
            {{ getFieldError('imageUrl') }}
          </div>
        </div>

        <div *ngIf="imagePreview" class="image-preview mt-4">
          <p class="text-sm text-gray-600 mb-2">Vista previa:</p>
          <img [src]="imagePreview"
               [alt]="productForm.get('name')?.value || 'Producto'"
               class="w-full h-48 object-cover rounded-lg border border-gray-200">
        </div>
      </div>

      <!-- Sustainability Info -->
      <div class="sustainability-info lg:col-span-2">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200">
          Información Ecológica
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="form-group">
            <label for="carbonFootprint" class="block text-sm font-medium text-gray-700 mb-2">
              Huella de Carbono (kg CO₂) *
            </label>
            <input type="number"
                   id="carbonFootprint"
                   formControlName="carbonFootprint"
                   step="0.01"
                   min="0"
                   placeholder="0.00"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                   [class.border-red-500]="carbonFootprint?.invalid && carbonFootprint?.touched">
            <div *ngIf="carbonFootprint?.invalid && carbonFootprint?.touched" class="error-message text-red-600 text-sm mt-1">
              {{ getFieldError('carbonFootprint') }}
            </div>
          </div>

          <div class="form-group">
            <label for="sustainabilityScore" class="block text-sm font-medium text-gray-700 mb-2">
              Puntaje de Sostenibilidad (0-100) *
            </label>
            <input type="number"
                   id="sustainabilityScore"
                   formControlName="sustainabilityScore"
                   min="0"
                   max="100"
                   placeholder="85"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                   [class.border-red-500]="sustainabilityScore?.invalid && sustainabilityScore?.touched">
            <div *ngIf="sustainabilityScore?.invalid && sustainabilityScore?.touched" class="error-message text-red-600 text-sm mt-1">
              {{ getFieldError('sustainabilityScore') }}
            </div>
          </div>

          <div class="form-group">
            <label for="ecoRating" class="block text-sm font-medium text-gray-700 mb-2">
              Rating Ecológico (1-5) *
            </label>
            <input type="number"
                   id="ecoRating"
                   formControlName="ecoRating"
                   min="1"
                   max="5"
                   step="0.1"
                   placeholder="4.5"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"
                   [class.border-red-500]="ecoRating?.invalid && ecoRating?.touched">
            <div *ngIf="ecoRating?.invalid && ecoRating?.touched" class="error-message text-red-600 text-sm mt-1">
              {{ getFieldError('ecoRating') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Tags -->
      <div class="tags-section lg:col-span-2">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200">
          Etiquetas del Producto
        </h2>

        <div class="form-group">
          <label class="block text-sm font-medium text-gray-700 mb-3">
            Etiquetas seleccionadas
          </label>
          <div class="flex flex-wrap gap-2 mb-4" *ngIf="tagsFormArray.length > 0">
            <span *ngFor="let tag of tagsFormArray.controls; let i = index"
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
              {{ tag.value }}
              <button type="button" (click)="removeTag(i)" class="ml-2 text-green-600 hover:text-green-800">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </span>
          </div>

          <label class="block text-sm font-medium text-gray-700 mb-3">
            Agregar etiquetas disponibles
          </label>
          <div class="tags-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            <button type="button"
                    *ngFor="let tag of availableTags"
                    (click)="addTag(tag)"
                    [disabled]="tagsFormArray.value.includes(tag)"
                    class="tag-button px-4 py-2 rounded-full border text-sm font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    [class.bg-green-100]="tagsFormArray.value.includes(tag)"
                    [class.border-green-500]="tagsFormArray.value.includes(tag)"
                    [class.text-green-800]="tagsFormArray.value.includes(tag)"
                    [class.bg-gray-50]="!tagsFormArray.value.includes(tag)"
                    [class.border-gray-300]="!tagsFormArray.value.includes(tag)"
                    [class.text-gray-700]="!tagsFormArray.value.includes(tag)"
                    [class.hover:bg-green-50]="!tagsFormArray.value.includes(tag)">
              {{ tag }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions flex flex-col sm:flex-row gap-4 mt-8 pt-6 border-t border-gray-200">
      <button type="submit"
              [disabled]="isSubmitting || productForm.invalid"
              class="submit-btn bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2">
        <svg *ngIf="isSubmitting" class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        {{ isSubmitting ? 'Guardando...' : (isEditMode ? 'Actualizar Producto' : 'Crear Producto') }}
      </button>

      <button type="button"
              (click)="onCancel()"
              class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
        Cancelar
      </button>
    </div>
  </form>
</div>